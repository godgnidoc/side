#!/bin/bash -e

ncc build src/index.ts -m --v8-cache --no-source-map-register -o build
sed -i -e '1s|^|#!/usr/bin/env node\n|' build/index.js
chmod +x build/index.js
ln -rfs build/index.js build/side

build/side vset \
  -f json \
  -o build/package.json \
  build/package.json \
  version=\"$(build/side vget package.json version)\"

build/side vset \
  -f json \
  -o build/package.json \
  build/package.json \
  revision=\"$(build/side vget build/build-info.json revision)\"